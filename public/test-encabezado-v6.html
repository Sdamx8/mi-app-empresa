<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Encabezado PDF v6.0 FINAL</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .btn {
            display: inline-block;
            padding: 12px 24px;
            margin: 10px;
            background: #0d47a1;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            font-size: 16px;
        }
        .btn:hover {
            background: #1565c0;
        }
        .status {
            margin: 20px 0;
            padding: 15px;
            border-radius: 5px;
            background: #e3f2fd;
            border-left: 5px solid #2196f3;
        }
        .error {
            background: #ffebee;
            border-left-color: #f44336;
            color: #c62828;
        }
        .success {
            background: #e8f5e8;
            border-left-color: #4caf50;
            color: #2e7d32;
        }
        .warning {
            background: #fff3e0;
            border-left-color: #ff9800;
            color: #ef6c00;
        }
        h1 {
            color: #0d47a1;
            border-bottom: 3px solid #0d47a1;
            padding-bottom: 10px;
        }
        h2 {
            color: #1565c0;
            margin-top: 30px;
        }
        .feature-list {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .feature-list ul {
            margin: 0;
        }
        .feature-list li {
            margin: 5px 0;
        }
        .code {
            background: #263238;
            color: #ffffff;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ Test Encabezado PDF v6.0 FINAL</h1>
        
        <div class="status">
            <strong>VERSI√ìN 6.0 FINAL - ENCABEZADO PERFECTO</strong><br>
            Esta versi√≥n implementa el encabezado exactamente como la imagen 2 usando canvas completo.
        </div>

        <div class="feature-list">
            <h3>‚úÖ Caracter√≠sticas Implementadas:</h3>
            <ul>
                <li><strong>Fondo azul completo:</strong> Canvas de 612px (ancho p√°gina) sin m√°rgenes</li>
                <li><strong>Logo en c√≠rculo blanco:</strong> C√≠rculo perfecto con logo centrado</li>
                <li><strong>Informaci√≥n corporativa:</strong> Alineada a la derecha en texto blanco</li>
                <li><strong>Posicionamiento absoluto:</strong> Sin conflictos con m√°rgenes del documento</li>
                <li><strong>M√°rgenes ISO:</strong> 0 superior para encabezado, 2.5cm para contenido</li>
                <li><strong>Fuentes Roboto:</strong> Tipograf√≠a est√°ndar ISO 9001:2015</li>
            </ul>
        </div>

        <h2>üß™ Pruebas Disponibles</h2>
        
        <div>
            <button class="btn" onclick="verificarVersion()">üîç Verificar Versi√≥n</button>
            <button class="btn" onclick="probarEncabezado()">üéØ Probar Encabezado</button>
            <button class="btn" onclick="limpiarCache()">üßπ Limpiar Cach√©</button>
            <button class="btn" onclick="generarPDFPrueba()">üìÑ Generar PDF de Prueba</button>
        </div>

        <div id="resultado" class="status" style="display:none;"></div>

        <h2>üìã Instrucciones</h2>
        <ol>
            <li><strong>Verificar Versi√≥n:</strong> Confirma que se est√° usando la versi√≥n 6.0 FINAL</li>
            <li><strong>Limpiar Cach√©:</strong> Fuerza la recarga del m√≥dulo PDF actualizado</li>
            <li><strong>Probar Encabezado:</strong> Valida la configuraci√≥n del encabezado</li>
            <li><strong>Generar PDF:</strong> Crea un PDF de prueba con datos ficticios</li>
        </ol>

        <div class="feature-list">
            <h3>üéØ Lo que debe aparecer en el PDF:</h3>
            <ul>
                <li>Encabezado azul que ocupe todo el ancho superior</li>
                <li>Logo GMS dentro de un c√≠rculo blanco a la izquierda</li>
                <li>Texto "GLOBAL MOBILITY SOLUTIONS GMS SAS" en blanco, negrilla, derecha</li>
                <li>Subt√≠tulo "INFORME T√âCNICO DE SERVICIOS" en blanco, derecha</li>
                <li>Informaci√≥n de contacto en texto peque√±o, blanco, derecha</li>
                <li>Sin m√°rgenes laterales ni superiores en el encabezado</li>
                <li>Contenido del documento con m√°rgenes normales de 2.5cm</li>
            </ul>
        </div>

        <div class="code" id="console-output">
            Consola de pruebas - Los resultados aparecer√°n aqu√≠...
        </div>
    </div>

    <script>
        function mostrarResultado(mensaje, tipo = 'status') {
            const resultado = document.getElementById('resultado');
            resultado.className = `status ${tipo}`;
            resultado.innerHTML = mensaje;
            resultado.style.display = 'block';
            
            // Tambi√©n mostrar en consola personalizada
            const consoleOutput = document.getElementById('console-output');
            const timestamp = new Date().toLocaleTimeString();
            consoleOutput.innerHTML += `<br>[${timestamp}] ${mensaje.replace(/<[^>]*>/g, '')}`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        async function verificarVersion() {
            try {
                mostrarResultado('üîç Verificando versi√≥n del servicio PDF...', 'status');
                
                // Importar din√°micamente para evitar cach√©
                const timestamp = Date.now();
                const module = await import(`/src/services/pdf.js?v=${timestamp}`);
                
                if (module.obtenerVersionPDF) {
                    const version = module.obtenerVersionPDF();
                    console.log('Versi√≥n detectada:', version);
                    
                    if (version.includes('v6.0 FINAL') && version.includes('ENCABEZADO PERFECTO')) {
                        mostrarResultado(`‚úÖ <strong>√âXITO!</strong><br>Versi√≥n correcta detectada:<br><code>${version}</code>`, 'success');
                        return true;
                    } else {
                        mostrarResultado(`‚ö†Ô∏è <strong>Versi√≥n incorrecta</strong><br>Detectada: <code>${version}</code><br>Esperada: v6.0 FINAL`, 'warning');
                        return false;
                    }
                } else {
                    mostrarResultado('‚ùå No se pudo obtener la versi√≥n del m√≥dulo', 'error');
                    return false;
                }
            } catch (error) {
                console.error('Error verificando versi√≥n:', error);
                mostrarResultado(`‚ùå <strong>Error:</strong> ${error.message}`, 'error');
                return false;
            }
        }

        async function limpiarCache() {
            try {
                mostrarResultado('üßπ Limpiando cach√© del navegador...', 'status');
                
                // Limpiar cach√© de m√≥dulos
                if ('moduleCache' in window) {
                    delete window.moduleCache;
                }
                
                // Limpiar service worker cache
                if ('caches' in window) {
                    const cacheNames = await caches.keys();
                    await Promise.all(cacheNames.map(name => caches.delete(name)));
                }
                
                // Forzar recarga con timestamp
                const timestamp = Date.now();
                const link = document.createElement('link');
                link.rel = 'preload';
                link.href = `/src/services/pdf.js?v=${timestamp}`;
                link.as = 'script';
                document.head.appendChild(link);
                
                setTimeout(() => {
                    mostrarResultado('‚úÖ <strong>Cach√© limpiado exitosamente</strong><br>El m√≥dulo PDF deber√≠a recargarse con la nueva versi√≥n.', 'success');
                }, 1000);
                
            } catch (error) {
                console.error('Error limpiando cach√©:', error);
                mostrarResultado(`‚ùå <strong>Error limpiando cach√©:</strong> ${error.message}`, 'error');
            }
        }

        async function probarEncabezado() {
            try {
                mostrarResultado('üéØ Probando configuraci√≥n del encabezado...', 'status');
                
                // Verificar primero la versi√≥n
                const versionCorrecta = await verificarVersion();
                if (!versionCorrecta) {
                    mostrarResultado('‚ö†Ô∏è <strong>Advertencia:</strong> Versi√≥n incorrecta detectada. Limpia el cach√© primero.', 'warning');
                    return;
                }
                
                mostrarResultado('‚úÖ <strong>Configuraci√≥n del encabezado validada</strong><br>La versi√≥n 6.0 FINAL est√° cargada y lista.', 'success');
                
            } catch (error) {
                console.error('Error probando encabezado:', error);
                mostrarResultado(`‚ùå <strong>Error:</strong> ${error.message}`, 'error');
            }
        }

        async function generarPDFPrueba() {
            try {
                mostrarResultado('üìÑ Generando PDF de prueba...', 'status');
                
                // Verificar versi√≥n primero
                const versionCorrecta = await verificarVersion();
                if (!versionCorrecta) {
                    mostrarResultado('‚ùå <strong>Error:</strong> Versi√≥n incorrecta. Limpia el cach√© primero.', 'error');
                    return;
                }
                
                // Importar el m√≥dulo
                const timestamp = Date.now();
                const module = await import(`/src/services/pdf.js?v=${timestamp}`);
                
                // Datos de prueba
                const informePrueba = {
                    idInforme: 'TEST-001',
                    remision: 'PRUEBA-ENCABEZADO-V6',
                    movil: 'TEST-MOVIL',
                    tituloTrabajo: 'Prueba de Encabezado v6.0 FINAL',
                    tecnico: 'T√©cnico de Prueba',
                    autorizo: 'Supervisor de Prueba',
                    une: 'UNE-PRUEBA',
                    subtotal: 100000,
                    total: 119000,
                    observacionesTecnicas: 'Esta es una prueba del encabezado v6.0 FINAL.\nEl encabezado debe aparecer exactamente como la imagen 2.\nLogo en c√≠rculo blanco a la izquierda, informaci√≥n corporativa a la derecha.',
                    imagenesAntes: [],
                    imagenesDespues: []
                };
                
                const empleadoPrueba = {
                    nombre_completo: 'Usuario de Prueba PDF v6.0'
                };
                
                // Generar PDF
                await module.generarPDFInforme(informePrueba, {
                    currentEmployee: empleadoPrueba,
                    abrirEnNuevaVentana: true,
                    incluirLogo: true
                });
                
                mostrarResultado('‚úÖ <strong>PDF generado exitosamente</strong><br>Verifica que el encabezado sea exactamente como la imagen 2:<br>‚Ä¢ Fondo azul sin m√°rgenes<br>‚Ä¢ Logo en c√≠rculo blanco (izquierda)<br>‚Ä¢ Informaci√≥n corporativa (derecha)', 'success');
                
            } catch (error) {
                console.error('Error generando PDF:', error);
                mostrarResultado(`‚ùå <strong>Error generando PDF:</strong> ${error.message}`, 'error');
            }
        }

        // Limpiar consola
        function limpiarConsola() {
            document.getElementById('console-output').innerHTML = 'Consola de pruebas - Los resultados aparecer√°n aqu√≠...';
        }

        // Auto-verificar versi√≥n al cargar
        window.addEventListener('load', () => {
            setTimeout(() => {
                verificarVersion();
            }, 1000);
        });
    </script>
</body>
</html>
